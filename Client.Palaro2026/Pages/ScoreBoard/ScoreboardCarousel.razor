@page "/scoreboard/carousel"
@page "/scoreboard/carousel/{TargetSport}"
@using System.Threading
@using System.Linq
@using Client.Palaro2026.Services
@inject APIService apiService
@inject NavigationManager Navigation
@implements IDisposable
@layout NoMainLayout

<PageTitle>@(TargetSport ?? "Live") Carousel (Light) | PALARO 2026</PageTitle>

<style>
    /* 1. EVIL EMPIRE (Header/Title) */
    @@import url('https://fonts.cdnfonts.com/css/evil-empire');

    /* 2. GOOGLE FONTS */
    @@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Chakra+Petch:wght@600;700;800&display=swap');

    :root {
        /* PALARO COLOR PALETTE */
        --pal-blue: #023E8A;
        --pal-dark-blue: #001845;
        --pal-gold: #FFB400;
        --pal-red: #EA0000;
        --pal-white: #ffffff;
        /* LIGHT THEME VARS */
        --bg-gradient-start: #f8f9fa;
        --bg-gradient-end: #e9ecef;
        --text-primary: #001845;
        --text-secondary: #023E8A;
        --card-bg: rgba(255, 255, 255, 0.95);
        /* FONT SETTINGS */
        --font-header: 'Evil Empire', sans-serif;
        --font-subheader: 'Corbel', 'Nunito', sans-serif;
        --font-body: 'Avenir Book', 'Avenir', 'Nunito', sans-serif;
    }

    html, body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: var(--bg-gradient-start);
        font-family: var(--font-body);
    }

    .carousel-container {
        height: 100vh;
        width: 100vw;
        background: radial-gradient(circle at 50% 30%, #ffffff 0%, #e0e7ff 100%);
        position: relative;
        padding: 4vh 8vw 10vh 8vw;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
    }

    /* --- STEADY FOOTER (Smaller Height) --- */
    .ticker-footer {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 7vh;
        background: linear-gradient(to bottom, #ffffff, #f1f3f5);
        border-top: 3px solid var(--pal-gold);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
    }

    .ticker-track {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4vw;
        width: 100%;
        height: 100%;
    }

    .footer-logo {
        height: 3vh;
        width: auto;
        object-fit: contain;
        filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
    }

    /* MUD CAROUSEL */
    .mud-carousel {
        height: 100% !important;
        width: 100% !important;
        flex-grow: 1;
        overflow: hidden;
    }

        .mud-carousel .mud-carousel-item {
            height: 100%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

    /* WRAPPER */
    .scoreboard-wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* Center Vertically */
    }

    /* --- SPORT PILL --- */
    .match-info-container {
        text-align: center;
        margin-bottom: 5vh;
        padding: 60px;
        border-radius: 40px;
        background: var(--pal-dark-blue);
        border: 3px solid var(--pal-gold);
        flex-shrink: 0;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .sport-title {
        font-family: var(--font-header);
        font-size: clamp(30px, 6vh, 70px);
        font-weight: 400;
        color: white;
        text-transform: uppercase;
        letter-spacing: 2px;
        line-height: 1;
        text-shadow: 2px 2px 0px #000000;
    }

    .match-meta {
        font-family: 'Chakra Petch', sans-serif;
        font-size: clamp(14px, 2.5vh, 25px);
        color: var(--pal-gold);
        letter-spacing: 2px;
        font-weight: 700;
        text-transform: uppercase;
    }

    /* --- MATCH CARD --- */
    .match-card {
        display: grid;
        grid-template-columns: 1fr 1fr 0.4fr 1fr 1fr;
        grid-template-rows: 1fr auto;
        grid-template-areas:
            "teamA scoreA center scoreB teamB"
            "history history history history history";
        align-items: center;
        width: 100%;
        height: auto;
        min-height: 55vh;
        background: var(--card-bg);
        border: 1px solid #d1d9e6;
        border-top: 5px solid var(--pal-gold);
        border-bottom: 5px solid var(--pal-blue);
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        border-radius: 30px;
        padding: 2vh 1vw;
        position: relative;
    }

    .area-team-a {
        grid-area: teamA;
    }

    .area-score-a {
        grid-area: scoreA;
    }

    .area-center {
        grid-area: center;
    }

    .area-score-b {
        grid-area: scoreB;
    }

    .area-team-b {
        grid-area: teamB;
    }

    .area-history {
        grid-area: history;
    }

    .team-col {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    .logo-circle {
        width: clamp(90px, 16vh, 200px);
        height: clamp(90px, 16vh, 200px);
        background: white;
        border-radius: 50%;
        border: 5px solid #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .winner-glow {
        border-color: var(--pal-gold);
        box-shadow: 0 0 25px rgba(255, 180, 0, 0.4);
    }

    /* --- TEAM NAME --- */
    .team-name {
        font-family: var(--font-header);
        font-size: clamp(20px, 4.5vh, 50px);
        font-weight: 400;
        color: var(--text-primary);
        line-height: 1.2;
        letter-spacing: 2px;
        margin-top: 2vh;
        margin-bottom: 1vh;
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .team-region {
        font-family: var(--font-body);
        font-size: clamp(12px, 2vh, 40px);
        color: var(--pal-blue);
        text-transform: uppercase;
        font-weight: 700;
    }

    .score-col {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .main-score {
        font-family: 'Corbel', sans-serif;
        font-size: clamp(100px, 100vh, 400px);
        font-weight: 700;
        font-style: normal;
        color: #455a64;
        line-height: 0.8;
        letter-spacing: -4px;
    }

    .score-winner {
        color: var(--pal-dark-blue);
        text-shadow: 5px 5px 0px rgba(255, 180, 0, 0.2);
        transform: scale(1.1);
        transition: all 0.3s ease;
    }

    .center-col {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1vh;
        z-index: 5;
    }

    /* --- UPDATED FORMAL BADGE --- */
    .status-badge {
        padding: 5px 25px;
        border-radius: 50px;
        /* Formal/Official Look */
        font-family: 'Chakra Petch', sans-serif;
        font-weight: 700;
        font-style: normal; /* No Italic */
        letter-spacing: 1.5px;
        text-transform: uppercase;
        font-size: clamp(14px, 2.2vh, 28px);
        background: var(--pal-red);
        border: 2px solid white;
        color: white;
        white-space: nowrap;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }

    .sets-score {
        font-family: var(--font-body);
        font-size: clamp(35px, 6vh, 80px);
        color: var(--pal-dark-blue);
        font-weight: 800;
        white-space: nowrap;
        letter-spacing: -1px;
    }

    .vs-text {
        font-family: var(--font-subheader);
        font-size: 3vh;
        color: #90a4ae;
        font-style: italic;
        font-weight: 900;
    }

    /* HISTORY STRIP (CLEANER TABLE) */
    .history-strip {
        grid-area: history;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        margin-top: 2vh;
        border-top: 1px solid rgba(0, 24, 69, 0.1);
        padding-top: 2vh;
    }

    .box-score-container {
        background: transparent;
        border: none;
        border-radius: 0;
        padding: 0;
        overflow-x: auto;
        max-width: 100%;
        display: flex;
        justify-content: center;
    }

    .history-table {
        border-collapse: collapse;
        text-align: center;
    }

        .history-table th {
            padding: 0 1.5vw 1vh 1.5vw;
            color: #90a4ae;
            font-family: 'Chakra Petch', sans-serif;
            font-size: clamp(12px, 1.8vh, 18px);
            font-weight: 600;
            text-transform: uppercase;
            border-bottom: 2px solid var(--pal-gold);
        }

        .history-table td {
            padding: 1.5vh 1.5vw 0 1.5vw;
            color: var(--pal-dark-blue);
            font-family: 'Nunito', sans-serif;
            font-size: clamp(16px, 2.5vh, 28px);
            font-weight: 800;
        }

    .team-head {
        text-align: right;
        padding-right: 2vw;
    }

    .team-abbr {
        text-align: right;
        padding-right: 2vw;
        font-weight: 700;
        color: var(--pal-blue);
    }

    .set-win {
        color: var(--pal-red) !important;
    }

    /* RESPONSIVE */
    @@media (max-width: 1024px) {
        .carousel-container {
            padding: 2vh 3vw 12vh 3vw;
            height: 100vh;
        }

        .ticker-footer {
            height: 6vh;
        }

        .footer-logo {
            height: 2.5vh;
        }

        .match-card {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto auto auto auto;
            grid-template-areas:
                "center center"
                "teamA teamB"
                "scoreA scoreB"
                "history history";
            gap: 1vh 2vw;
            padding: 2vh 3vw;
            min-height: auto;
            transform: scale(0.95);
        }

        .main-score {
            font-size: 140px;
        }

        .history-strip {
            margin-top: 1vh;
            padding-top: 1vh;
        }
    }
</style>

<div class="carousel-container">

    @if (_isLoading)
    {
        <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Style="height:80vh; width:100%;">
            <MudProgressCircular Indeterminate="true" Style="color: #023E8A; transform: scale(2);" Size="Size.Large" />
        </MudStack>
    }
    else if (_activeMatches.Count == 0)
    {
        <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Style="height:80vh; width:100%;">
            <MudIcon Icon="@Icons.Material.Filled.TvOff" Style="color: #b0bec5; width: 10vh; height: 10vh;" />
            <MudText Typo="Typo.h5" Class="mt-3" Style="color: #001845; font-family:'Evil Empire', sans-serif;">NO LIVE GAMES</MudText>
        </MudStack>
    }
    else
    {
        <MudCarousel Class="mud-width-full"
                     Style="height:100%;"
                     ShowArrows="false"
                     ShowBullets="false"
                     EnableSwipeGesture="true"
                     AutoCycle="true"
                     TData="object"
                     CycleTime="@TimeSpan.FromSeconds(20)">

            @foreach (var match in _activeMatches)
            {
                <MudCarouselItem Transition="Transition.Fade" Color="@Color.Transparent">
                    <div class="scoreboard-wrapper">

                        <div class="match-info-container">
                            <div class="sport-title">@GetCleanSportName(match.EventData.Sport)</div>
                            <div class="match-meta">
                                @GetSchoolLevel(match.EventData.Sport) • @match.EventData.Gender • @match.EventData.EventStage
                            </div>
                        </div>

                        <div class="match-card">
                            <!-- Center Status -->
                            <div class="center-col area-center">
                                @if (!string.IsNullOrEmpty(match.PhaseText))
                                {
                                    <div class="status-badge">@match.PhaseText</div>
                                }
                                <div class="vs-text">VS</div>
                                @if (match.IsSetGame)
                                {
                                    <div class="sets-container">
                                        <div class="sets-score">@match.SetsA - @match.SetsB</div>
                                    </div>
                                }
                            </div>

                            <!-- Team A -->
                            <div class="team-col area-team-a">
                                <div class="logo-circle @(match.IsWinnerA ? "winner-glow" : "")">
                                    <MudImage Src="@($"https://palarongpambansa2026.com/attachments/media/regions/team_logo/{match.TeamA.Region}.webp")" ObjectFit="ObjectFit.Contain" Style="width:250%; height:250%;" />
                                </div>
                                <div class="team-name">@match.TeamA.Abbreviation</div>
                                <div class="team-region">@match.TeamA.Region</div>
                            </div>

                            <!-- Score A -->
                            <div class="score-col area-score-a">
                                <div class="main-score @(match.IsWinnerA ? "score-winner" : "")">@match.DisplayScoreA</div>
                            </div>

                            <!-- Score B -->
                            <div class="score-col area-score-b">
                                <div class="main-score @(match.IsWinnerB ? "score-winner" : "")">@match.DisplayScoreB</div>
                            </div>

                            <!-- Team B -->
                            <div class="team-col area-team-b">
                                <div class="logo-circle @(match.IsWinnerB ? "winner-glow" : "")">
                                    <MudImage Src="@($"https://palarongpambansa2026.com/attachments/media/regions/team_logo/{match.TeamB.Region}.webp")" ObjectFit="ObjectFit.Contain" Style="width:250%; height:250%;" />
                                </div>
                                <div class="team-name">@match.TeamB.Abbreviation</div>
                                <div class="team-region">@match.TeamB.Region</div>
                            </div>

                            <!-- HISTORY TABLE -->
                            <div class="history-strip area-history">
                                @if (match.MatchHistory != null && match.MatchHistory.Any())
                                {
                                    <div class="box-score-container">
                                        <table class="history-table">
                                            <thead>
                                                <tr>
                                                    <th class="team-head">TEAM</th>
                                                    @foreach (var set in match.MatchHistory)
                                                    {
                                                        <th>@GetTableColumnHeader(match.EventData.Sport, set.PhaseNumber)</th>
                                                    }
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="team-abbr">@match.TeamA.Abbreviation</td>
                                                    @foreach (var set in match.MatchHistory)
                                                    {
                                                        <td class="@(set.ScoreA > set.ScoreB ? "set-win" : "")">@set.ScoreA</td>
                                                    }
                                                </tr>
                                                <tr>
                                                    <td class="team-abbr">@match.TeamB.Abbreviation</td>
                                                    @foreach (var set in match.MatchHistory)
                                                    {
                                                        <td class="@(set.ScoreB > set.ScoreA ? "set-win" : "")">@set.ScoreB</td>
                                                    }
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </MudCarouselItem>
            }
        </MudCarousel>
    }

    <!-- NEWS STYLE TICKER FOOTER -->
    <div class="ticker-footer">
        <div class="ticker-track">
            <img src="/media/images/2031.png" class="footer-logo" alt="Palaro Logo" />
            <img src="/media/images/deped.png" class="footer-logo" alt="DepEd" />
            <img src="/media/images/bagongpilipinas.png" class="footer-logo" alt="Bagong Pilipinas" />
            <img src="/media/logo/Palarong Pambansa Logo.webp" onerror="this.src='/media/images/2031.png'" class="footer-logo" alt="Runner Logo" />
            <img src="/media/images/pgas.png" class="footer-logo" alt="LGU Agusan" />
        </div>
    </div>

</div>

@code {
    [Parameter] public string? TargetSport { get; set; }

    public class CarouselMatchViewModel
    {
        public string EventID { get; set; } = "";
        public EventModel EventData { get; set; } = new();
        public EventVersusTeams TeamA { get; set; } = new();
        public EventVersusTeams TeamB { get; set; } = new();

        public int DisplayScoreA { get; set; }
        public int DisplayScoreB { get; set; }
        public int SetsA { get; set; }
        public int SetsB { get; set; }
        public bool IsSetGame { get; set; }
        public string PhaseText { get; set; } = "";
        public bool IsWinnerA { get; set; }
        public bool IsWinnerB { get; set; }
        public List<PhaseScoreModel> MatchHistory { get; set; } = new();
    }

    public class PhaseScoreModel
    {
        public int PhaseNumber { get; set; }
        public int ScoreA { get; set; }
        public int ScoreB { get; set; }
    }

    public class EventModel
    {
        public string ID { get; set; } = "";
        public string? Sport { get; set; }
        public string? Gender { get; set; }
        public string? EventStage { get; set; }
        public bool? IsFinished { get; set; }
        public List<EventVersusTeams>? EventVersusList { get; set; }
    }

    public class EventVersusTeams
    {
        public string? Region { get; set; }
        public string? Abbreviation { get; set; }
    }

    public class ClientTeamMatchDTO
    {
        public string? EventID { get; set; }
        public string? Region { get; set; }
        public int Phase { get; set; }
        public int Score { get; set; }
    }

    private List<CarouselMatchViewModel> _activeMatches = new();
    private bool _isLoading = true;
    private Timer? _timer;

    private const int DATA_REFRESH_RATE_MS = 5000;

    protected override async Task OnInitializedAsync()
    {
        await LoadCarouselData();
        _timer = new Timer(async _ => await InvokeAsync(RefreshScoresOnly), null, DATA_REFRESH_RATE_MS, DATA_REFRESH_RATE_MS);
    }

    private async Task LoadCarouselData()
    {
        try
        {
            var allEvents = await apiService.GetAsync<EventModel>("/Events/Details");

            if (allEvents != null)
            {
                var teamMatches = allEvents
                    .Where(e => e.EventVersusList?.Count == 2)
                    .Where(e => IsAllowedTeamSport(e.Sport))
                    .Where(e => e.IsFinished != true)
                    .ToList();

                if (!string.IsNullOrEmpty(TargetSport))
                {
                    teamMatches = teamMatches
                        .Where(e => (e.Sport?.ToLower() ?? "").Contains(TargetSport.ToLower()))
                        .ToList();
                }

                var viewModels = new List<CarouselMatchViewModel>();

                foreach (var evt in teamMatches)
                {
                    var scores = await apiService.GetAsync<ClientTeamMatchDTO>($"score/TeamMatch?eventId={evt.ID}");
                    var vm = ProcessMatchData(evt, scores ?? new List<ClientTeamMatchDTO>());
                    viewModels.Add(vm);
                }

                _activeMatches = viewModels;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading carousel: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
            StateHasChanged();
        }
    }

    private async Task RefreshScoresOnly()
    {
        if (_activeMatches.Count == 0) return;

        foreach (var match in _activeMatches)
        {
            try
            {
                var scores = await apiService.GetAsync<ClientTeamMatchDTO>($"score/TeamMatch?eventId={match.EventID}");
                if (scores != null)
                {
                    var updatedVM = ProcessMatchData(match.EventData, scores);
                    match.DisplayScoreA = updatedVM.DisplayScoreA;
                    match.DisplayScoreB = updatedVM.DisplayScoreB;
                    match.SetsA = updatedVM.SetsA;
                    match.SetsB = updatedVM.SetsB;
                    match.PhaseText = updatedVM.PhaseText;
                    match.IsWinnerA = updatedVM.IsWinnerA;
                    match.IsWinnerB = updatedVM.IsWinnerB;
                    match.MatchHistory = updatedVM.MatchHistory;
                }
            }
            catch { }
        }
        StateHasChanged();
    }

    private bool IsAllowedTeamSport(string? sport)
    {
        if (string.IsNullOrEmpty(sport)) return false;
        var s = sport.ToLower();
        return s.Contains("basket") || s.Contains("volley") || s.Contains("tennis") ||
               s.Contains("badminton") || s.Contains("sepak") || s.Contains("futsal") ||
               s.Contains("football") || s.Contains("soccer") || s.Contains("base") || s.Contains("soft");
    }

    private CarouselMatchViewModel ProcessMatchData(EventModel evt, List<ClientTeamMatchDTO> scores)
    {
        var vm = new CarouselMatchViewModel
        {
            EventID = evt.ID,
            EventData = evt,
            TeamA = evt.EventVersusList![0],
            TeamB = evt.EventVersusList![1]
        };

        bool isSetGame = IsSetBasedSport(evt.Sport);
        vm.IsSetGame = isSetGame;

        if (!scores.Any()) return vm;

        int maxPhase = scores.Max(s => s.Phase);
        vm.PhaseText = GetPhaseText(evt.Sport, maxPhase);

        for (int i = 1; i <= maxPhase; i++)
        {
            var sA = GetScore(scores, vm.TeamA.Region, i);
            var sB = GetScore(scores, vm.TeamB.Region, i);

            if (sA > 0 || sB > 0 || i == maxPhase)
            {
                vm.MatchHistory.Add(new PhaseScoreModel { PhaseNumber = i, ScoreA = sA, ScoreB = sB });
            }
        }

        if (isSetGame)
        {
            int setsA = 0, setsB = 0;
            for (int i = 1; i <= maxPhase; i++)
            {
                var sA = GetScore(scores, vm.TeamA.Region, i);
                var sB = GetScore(scores, vm.TeamB.Region, i);

                if (i < maxPhase)
                {
                    if (sA > sB) setsA++;
                    else if (sB > sA) setsB++;
                }
            }
            vm.SetsA = setsA;
            vm.SetsB = setsB;
            vm.DisplayScoreA = GetScore(scores, vm.TeamA.Region, maxPhase);
            vm.DisplayScoreB = GetScore(scores, vm.TeamB.Region, maxPhase);
        }
        else
        {
            vm.DisplayScoreA = scores.Where(s => s.Region == vm.TeamA.Region).Sum(s => s.Score);
            vm.DisplayScoreB = scores.Where(s => s.Region == vm.TeamB.Region).Sum(s => s.Score);
        }

        if (vm.DisplayScoreA > vm.DisplayScoreB) vm.IsWinnerA = true;
        if (vm.DisplayScoreB > vm.DisplayScoreA) vm.IsWinnerB = true;

        return vm;
    }

    private int GetScore(List<ClientTeamMatchDTO> scores, string? region, int phase)
    {
        return scores.FirstOrDefault(s => s.Region == region && s.Phase == phase)?.Score ?? 0;
    }

    private bool IsSetBasedSport(string? sport)
    {
        if (string.IsNullOrEmpty(sport)) return false;
        var s = sport.ToLower();
        return s.Contains("volley") || s.Contains("tennis") || s.Contains("badminton") || s.Contains("sepak") || s.Contains("table");
    }

    private string GetPhaseText(string? sport, int phase)
    {
        var s = sport?.ToLower() ?? "";
        if (s.Contains("basket"))
        {
            if (phase == 1) return "1ST QUARTER";
            if (phase == 2) return "2ND QUARTER";
            if (phase == 3) return "3RD QUARTER";
            if (phase == 4) return "4TH QUARTER";
            if (phase == 5) return "OVERTIME";
            return $"{phase - 4}OT";
        }
        if (s.Contains("base") || s.Contains("soft")) return $"INNING {phase}";
        return $"SET {phase}";
    }

    private string GetTableColumnHeader(string? sport, int phase)
    {
        var s = sport?.ToLower() ?? "";
        if (s.Contains("basket"))
        {
            if (phase <= 4) return $"Q{phase}";
            if (phase == 5) return "OT";
            return $"{phase - 4}OT";
        }
        if (s.Contains("base") || s.Contains("soft")) return $"{phase}";
        return phase.ToString();
    }

    private string GetSchoolLevel(string? sport)
    {
        if (string.IsNullOrEmpty(sport)) return "SECONDARY";
        var s = sport.ToUpper();
        if (s.Contains("ELEM")) return "ELEMENTARY";
        if (s.Contains("SEC") || s.Contains("HIGH")) return "SECONDARY";
        return "SECONDARY";
    }

    private string GetCleanSportName(string? sport)
    {
        if (string.IsNullOrEmpty(sport)) return "";
        string s = sport.Replace("(Elementary)", "", StringComparison.OrdinalIgnoreCase)
                        .Replace("(Secondary)", "", StringComparison.OrdinalIgnoreCase)
                        .Replace("Elementary", "", StringComparison.OrdinalIgnoreCase)
                        .Replace("Secondary", "", StringComparison.OrdinalIgnoreCase)
                        .Trim();
        return s;
    }

    public void Dispose() => _timer?.Dispose();
}