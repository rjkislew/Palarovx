@page "/sports/{Category}/{Sports}"

@using System.Net.Http
@using System.Text.Json
@using System.Threading.Tasks
@using Client.Palaro2026.Services
@inject IJSRuntime JSRuntime
@inject IDialogService DialogService
@inject APIService apiService
@inject HttpClient httpClient

<PageTitle>@Sports, @Category Category | PALARO 2026 - Agusan del Sur</PageTitle>

<MudGrid Justify="Justify.Center">
    <!-- Header -->
    <MudItem xs="12">
        <MudContainer Gutters="false" MaxWidth="MaxWidth.False">
            <MudPaper Outlined Height="300px" Square Elevation="0"
                      Style="@($"position: relative; overflow: hidden; background-image: url('media/sports/images/{Sports}.webp');  background-attachment: fixed; background-size: cover; background-position: center;")">

                <!-- Dark Overlay -->
                <MudStack
                    Style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);"></MudStack>

                <MudStack AlignItems="AlignItems.Center" Spacing="0" Justify="Justify.Center"
                          Style="height: 100%; position: relative; z-index: 1;">
                    <MudImage ObjectFit="ObjectFit.Contain" Height="50"
                              Src="@($"media/sports/icons/white/{Sports}.webp")"/>
                    <MudText Typo="Typo.h1" HtmlTag="h2" Style="color: white">@Sports</MudText>
                    <MudText Style="color: white">@Category</MudText>
                </MudStack>
            </MudPaper>
        </MudContainer>
    </MudItem>
    <MudItem xs="12">
        <MudContainer MaxWidth="MaxWidth.Large" Style="margin-bottom: 5rem;">
            <MudGrid>
                <MudItem xs="12">
                    <MudBreadcrumbs Style="font-size: 15px" Class="pa-0" Items="_items"></MudBreadcrumbs>
                    <MudDivider/>
                </MudItem>
                <MudItem xs="12">
                    <MudStack AlignItems="AlignItems.Center" Style="width: 100%">
                        <MudText Typo="Typo.body2">@_sportDescription</MudText>
                        <MudTabs KeepPanelsAlive Elevation="0" ApplyEffectsToContainer="true" PanelClass="pt-6" Centered
                                 Style="width: 100%" @bind-ActivePanelIndex="_activeTabIndex">

                            <!-- Event Schedule Tab -->
                            <MudTabPanel Style="text-transform: none" Text="Event Schedule">

                                <!-- Event Schedule Section -->
                                @if (GetFilteredGeneralSchedules().Any())
                                {
                                    <MudItem xs="12" Class="mb-8">
                                        @{
                                            var eventSchedules = GetFilteredGeneralSchedules();
                                            var eventDayGroups = GetSchedulesGroupedByDay(eventSchedules);
                                        }

                                        <MudStack Spacing="4" Style="margin-top: 2rem">

                                            <MudGrid Spacing="5">
                                                @foreach (var dayGroup in eventDayGroups)
                                                {
                                                    <MudItem xs="12" md="6" Class="d-flex flex-column">
                                                        <!-- Day Header -->
                                                        <MudPaper
                                                            Style="background: linear-gradient(240deg, #f5f7fa 0%, #c3cfe2 100%); padding: 16px 20px; border-radius: 8px; border: 1px solid #e0e0e0; margin-bottom: 16px;">
                                                            <MudStack Spacing="1">
                                                                <MudText Typo="Typo.h6"
                                                                         Style="color: #1a237e; font-weight: 600; margin: 0;">
                                                                    @dayGroup.DayLabel
                                                                </MudText>
                                                            </MudStack>
                                                        </MudPaper>

                                                        <!-- Schedule Card -->
                                                        <MudPaper Elevation="1"
                                                                  Style="border-radius: 8px; border: 1px solid #e0e0e0; flex: 1; display: flex; flex-direction: column;">
                                                            <MudStack Spacing="0" Style="flex: 1;">
                                                                @foreach (var schedule in dayGroup.Schedules)
                                                                {
                                                                    <MudGrid Spacing="2" 
                                                                             Style="padding: 25px; border-bottom: 1px solid #f0f0f0; flex: 1; min-height: 80px;"
                                                                             Class="schedule-item">

                                                                        <!-- Time Column -->
                                                                        <MudItem xs="12" md="5">
                                                                            <MudStack Spacing="1">
                                                                                <MudText Typo="Typo.body1"
                                                                                         Style="color: #1a237e; font-weight: 600; border-left: 3px solid #d32f2f; padding-left: 8px;">
                                                                                    @dayGroup.Date.ToString("MMMM dd, yyyy")
                                                                                </MudText>
                                                                            </MudStack>
                                                                        </MudItem>

                                                                        <!-- Content Column -->
                                                                        <MudItem xs="12" sm="7" md="12" lg="7">
                                                                            <MudStack Spacing="2" Style="height: 100%;">
                                                                                <!-- Description -->
                                                                                @if (!string.IsNullOrEmpty(schedule.Description))
                                                                                {
                                                                                    <MudText Typo="Typo.body1"
                                                                                             Style="color: #333; font-weight: 500; line-height: 1.4;">
                                                                                        @schedule.Description
                                                                                    </MudText>
                                                                                }

                                                                                <!-- Activities -->
                                                                                @if (schedule.Activities.Any())
                                                                                {
                                                                                    <MudStack Spacing="2"
                                                                                              Style="flex: 1;">
                                                                                        @foreach (var activity in schedule.Activities)
                                                                                        {
                                                                                            <MudGrid Spacing="1">
                                                                                                <!-- Activity Time (if different from schedule time) -->
                                                                                                @if (activity.Time.HasValue)
                                                                                                {
                                                                                                    <MudItem xs="12" sm="3">
                                                                                                        <MudText
                                                                                                            Typo="Typo.caption"
                                                                                                            Style="color: #d32f2f; font-weight: 500;">
                                                                                                            @DateTime.Today.Add(activity.Time.Value).ToString("hh:mm tt")
                                                                                                        </MudText>
                                                                                                    </MudItem>
                                                                                                    <MudItem xs="12" sm="9">
                                                                                                        <MudText
                                                                                                            Typo="Typo.body2"
                                                                                                            Style="color: #424242;">
                                                                                                            @activity.ActivityName
                                                                                                        </MudText>
                                                                                                    </MudItem>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <MudItem xs="12" sm="3">
                                                                                                        <MudText>
                                                                                                        </MudText>
                                                                                                    </MudItem>
                                                                                                    <MudItem xs="12" sm="9">
                                                                                                        <MudText
                                                                                                            Typo="Typo.body2"
                                                                                                            Style="color: #424242;">
                                                                                                            @activity.ActivityName
                                                                                                        </MudText>
                                                                                                    </MudItem>
                                                                                                }
                                                                                            </MudGrid>
                                                                                        }
                                                                                    </MudStack>
                                                                                }
                                                                            </MudStack>
                                                                        </MudItem>
                                                                    </MudGrid>
                                                                }
                                                            </MudStack>
                                                        </MudPaper>
                                                    </MudItem>
                                                }
                                            </MudGrid>
                                        </MudStack>
                                    </MudItem>
                                }

                                <!-- No Schedules Message -->
                                @if (!GetFilteredEventSchedules().Any() && !GetFilteredGeneralSchedules().Any())
                                {
                                    <MudItem xs="12">
                                        <MudStack AlignItems="AlignItems.Center" Justify="Justify.Center" Spacing="3"
                                                  Style="padding: 3rem 2rem;">
                                            <MudItem xs="12">
                                                <MudText Typo="Typo.h6" Align="Align.Center" Class="mb-2"
                                                         Style="letter-spacing: 1px;">
                                                    No event schedule at this time.
                                                </MudText>
                                            </MudItem>
                                            <MudText Typo="Typo.body2"
                                                     Style="color: #666; line-height: 1.5; text-align: center;">
                                                The event schedule will be published once finalized. Please check back
                                                for updates.
                                            </MudText>
                                        </MudStack>
                                    </MudItem>
                                }

                            </MudTabPanel>

                            @if (_sportSubcategories != null && _sportSubcategories.Any() == true)
                            {
                                @foreach (var group in _sportSubcategories.GroupBy(s => s.SchoolLevelID))
                                {
                                    <MudTabPanel Style="text-transform: none"
                                                 Text="@(group.Key == 1 ? "Elementary Level" : (group.Key == 2 ? "Secondary Level" : "SPED"))">

                                        <MudGrid Style="margin-bottom: 3rem;">
                                            <!-- Male Categories -->
                                            <MudItem xs="12">
                                                <MudPaper Outlined Class="pa-5">
                                                    <MudStack Spacing="5">
                                                        @if (group.Any(s => s.SportGenderCategoryID == 1))
                                                        {
                                                            <MudStack Spacing="2">
                                                                <MudStack Row>
                                                                    <MudText>Boys</MudText>
                                                                    <MudIcon Icon="@Icons.Material.Filled.Male"
                                                                             Color="Color.Info"/>
                                                                </MudStack>
                                                                <MudDivider/>
                                                                <MudStack Row Wrap="Wrap.Wrap" Spacing="0">
                                                                    @foreach (var subCategory in group.Where(s => s.SportGenderCategoryID == 1))
                                                                    {
                                                                        <MudChip T="string" Size="Size.Small"
                                                                                 Variant="Variant.Outlined">
                                                                            <MudStack Row
                                                                                      AlignItems="AlignItems.Center">
                                                                                <MudText Color="Color.Info">•</MudText>
                                                                                @subCategory.Subcategory
                                                                            </MudStack>
                                                                        </MudChip>
                                                                    }
                                                                </MudStack>
                                                            </MudStack>
                                                        }

                                                        @if (group.Any(s => s.SportGenderCategoryID == 2))
                                                        {
                                                            <MudStack Spacing="2">
                                                                <MudStack Row>
                                                                    <MudText>Girls</MudText>
                                                                    <MudIcon Icon="@Icons.Material.Filled.Female"
                                                                             Color="Color.Error"/>
                                                                </MudStack>
                                                                <MudDivider/>
                                                                <MudStack Row Wrap="Wrap.Wrap" Spacing="0">
                                                                    @foreach (var subCategory in group.Where(s => s.SportGenderCategoryID == 2))
                                                                    {
                                                                        <MudChip T="string" Size="Size.Small"
                                                                                 Variant="Variant.Outlined">
                                                                            <MudStack Row
                                                                                      AlignItems="AlignItems.Center">
                                                                                <MudText Color="Color.Error">•</MudText>
                                                                                @subCategory.Subcategory
                                                                            </MudStack>
                                                                        </MudChip>
                                                                    }
                                                                </MudStack>
                                                            </MudStack>
                                                        }

                                                        @if (group.Any(s => s.SportGenderCategoryID != 1 && s.SportGenderCategoryID != 2))
                                                        {
                                                            <MudStack Spacing="2">
                                                                <MudStack Row>
                                                                    <MudText>Mixed</MudText>
                                                                    <MudStack Row Spacing="0">
                                                                        <MudIcon Icon="@Icons.Material.Filled.Male"
                                                                                 Color="Color.Info"/>
                                                                        <MudIcon Icon="@Icons.Material.Filled.Female"
                                                                                 Color="Color.Error"/>
                                                                    </MudStack>
                                                                </MudStack>
                                                                <MudDivider/>
                                                                <MudStack Row Wrap="Wrap.Wrap" Spacing="0">
                                                                    @foreach (var subCategory in group.Where(s => s.SportGenderCategoryID != 1 && s.SportGenderCategoryID != 2))
                                                                    {
                                                                        <MudChip T="string" Size="Size.Small"
                                                                                 Variant="Variant.Outlined">
                                                                            <MudStack Row
                                                                                      AlignItems="AlignItems.Center">
                                                                                <MudStack Row Spacing="0">
                                                                                    <MudText Color="Color.Info">
                                                                                        •
                                                                                    </MudText>
                                                                                    <MudText Color="Color.Error">
                                                                                        •
                                                                                    </MudText>
                                                                                </MudStack>
                                                                                @subCategory.Subcategory
                                                                            </MudStack>
                                                                        </MudChip>
                                                                    }
                                                                </MudStack>
                                                            </MudStack>
                                                        }
                                                    </MudStack>
                                                </MudPaper>
                                            </MudItem>
                                        </MudGrid>

                                        <!-- Competition Schedule section (Filtered by School Level) -->
                                        @if (GetFilteredEventDetails(group.Key).Any())
                                        {
                                            <MudItem xs="12">
                                                <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-2"
                                                         Style="font-weight: bold; letter-spacing: 1px;">
                                                    COMPETITION SCHEDULE
                                                </MudText>
                                                <MudTable Outlined Items="GetFilteredEventDetails(group.Key)"
                                                          Context="eventDetail"
                                                          FixedHeader FixedFooter Height="calc(87vh - 150px)"
                                                          Virtualize="true" Elevation="0">

                                                    <ColGroup>
                                                        <MudHidden Breakpoint="Breakpoint.Xs">
                                                            <col style="width: 20%"/>
                                                            <col style="width: 25%"/>
                                                            <col style="width: 20%"/>
                                                            <col style="width: 20%"/>
                                                            <col style="width: 15%"/>
                                                        </MudHidden>
                                                    </ColGroup>

                                                    <HeaderContent>
                                                        <MudTh>Event</MudTh>
                                                        <MudTh>Opposing Teams</MudTh>
                                                        <MudTh>Venue</MudTh>
                                                        <MudTh>
                                                            <MudTableSortLabel
                                                                InitialDirection="SortDirection.Descending"
                                                                SortBy="new Func<EventsDTO.EventDetails.Event, object?>(x => x.Date)">
                                                                Schedule
                                                            </MudTableSortLabel>
                                                        </MudTh>
                                                        <MudTh>Stream Service</MudTh>
                                                    </HeaderContent>

                                                    <RowTemplate>
                                                        <MudTd Datalabel="Event">
                                                            <MudStack>
                                                                <MudStack Spacing="0">
                                                                    <MudText Style="font-weight: bold">
                                                                        @(string.IsNullOrWhiteSpace(eventDetail.SportMainCat)
                                                                            ? eventDetail.Sport
                                                                            : eventDetail.SportMainCat)
                                                                        <MudElement>
                                                                            <MudText Typo="Typo.caption">
                                                                                | @eventDetail.Subcategory
                                                                            </MudText>
                                                                        </MudElement>
                                                                    </MudText>

                                                                    <MudText Typo="Typo.caption">
                                                                        @eventDetail.Level ∙ @eventDetail.Gender
                                                                    </MudText>
                                                                </MudStack>

                                                                <MudStack Row Spacing="0">
                                                                    @if (@eventDetail.IsFinished == true)
                                                                    {
                                                                        <MudChip T="string" Color="Color.Success"
                                                                                 Size="Size.Small">
                                                                            Finished
                                                                        </MudChip>
                                                                    }
                                                                    else
                                                                    {
                                                                        <MudChip T="string" Color="Color.Warning"
                                                                                 Size="Size.Small">
                                                                            Ongoing
                                                                        </MudChip>
                                                                    }
                                                                    <MudChip T="string" Color="Color.Default"
                                                                             Size="Size.Small">@eventDetail.EventStage</MudChip>
                                                                </MudStack>
                                                            </MudStack>
                                                        </MudTd>
                                                        <MudTd Datalabel="Opposing Teams">
                                                            <MudStack Row Wrap="Wrap.Wrap" Justify="Justify.FlexStart"
                                                                      AlignItems="AlignItems.Stretch" Spacing="1"
                                                                      Class="py-2">
                                                                <MudVirtualize Items="@eventDetail.EventVersusList"
                                                                               Context="team">
                                                                    <MudPaper Outlined
                                                                              Class="pa-1 d-flex flex-column align-center justify-center"
                                                                              Style="flex: 1 1 85px; min-width: 80px; max-width: 100px; text-align: center; white-space: normal; word-break: break-word; display: flex;">
                                                                        <MudImage
                                                                            Src="@($"https://palarongpambansa2026.com/attachments/media/regions/team_logo/{team.Region}.webp")"
                                                                            Height="50" Width="50"
                                                                            ObjectFit="ObjectFit.Contain" Class="mb-1"/>

                                                                        <MudText
                                                                            Style="font-weight: bold; font-size: 0.7rem; text-align:center;">
                                                                            @team.Abbreviation
                                                                        </MudText>

                                                                        <MudText Typo="Typo.caption"
                                                                                 Style="font-size: 0.6rem; line-height: 1.1; text-align:center; white-space: normal; word-break: break-word;">
                                                                            @team.Region
                                                                        </MudText>
                                                                    </MudPaper>
                                                                </MudVirtualize>
                                                            </MudStack>
                                                        </MudTd>
                                                        <MudTd Datalabel="Venue">
                                                            <MudLink Underline="Underline.Hover"
                                                                     Href="@($"https://www.google.com/maps/?q={eventDetail.Latitude},{eventDetail.Longitude}")"
                                                                     Target="_blank">
                                                                <MudStack Row AlignItems="AlignItems.Center">
                                                                    <MudStack Spacing="0">
                                                                        <MudText Typo="Typo.body2">
                                                                            @eventDetail.Venue
                                                                        </MudText>
                                                                    </MudStack>
                                                                    <MudIcon Icon="@Icons.Material.Filled.OpenInNew"
                                                                             Size="Size.Small"/>
                                                                </MudStack>
                                                            </MudLink>
                                                        </MudTd>
                                                        <MudTd Datalabel="Schedule">
                                                            <MudStack Spacing="0">
                                                                <MudText
                                                                    Typo="Typo.caption">@(eventDetail.Date?.ToString("dddd - MMMM d") ?? "No Date")</MudText>
                                                                <MudText
                                                                    Typo="Typo.caption">@(eventDetail.Time.HasValue ? DateTime.Today.Add(eventDetail.Time.Value).ToString("hh:mm tt") : "No Time")</MudText>
                                                            </MudStack>
                                                        </MudTd>
                                                        <MudTd Datalabel="Stream Service">
                                                            @if (eventDetail.OnStream == true)
                                                            {
                                                                <MudLink Underline="Underline.Hover"
                                                                         Href="@($"{@eventDetail.StreamURL}")"
                                                                         Target="_blank">
                                                                    <MudStack Row AlignItems="AlignItems.Center">
                                                                        <MudText Typo="Typo.body2">
                                                                            @eventDetail.StreamService
                                                                        </MudText>
                                                                        <MudIcon Icon="@Icons.Material.Filled.OpenInNew"
                                                                                 Size="Size.Small"/>
                                                                    </MudStack>
                                                                </MudLink>
                                                            }
                                                            else
                                                            {
                                                                <MudText Typo="Typo.body2">No Stream Service Available
                                                                </MudText>
                                                            }
                                                        </MudTd>
                                                    </RowTemplate>

                                                    <NoRecordsContent>
                                                        <MudText Typo="Typo.caption">No records found.</MudText>
                                                    </NoRecordsContent>

                                                    <PagerContent>
                                                        <MudTablePager
                                                            PageSizeOptions="new int[] { 10, 25, 50, 100, int.MaxValue }"
                                                            HideRowsPerPage="true"/>
                                                    </PagerContent>
                                                </MudTable>
                                            </MudItem>
                                        }
                                        else
                                        {
                                            <MudItem xs="12">
                                                <MudText Typo="Typo.h6" Align="Align.Center" Class="mb-2"
                                                         Style="letter-spacing: 1px;">
                                                    No competition schedule at this time.
                                                </MudText>
                                            </MudItem>
                                        }
                                    </MudTabPanel>
                                }
                            }
                        </MudTabs>
                    </MudStack>
                </MudItem>
            </MudGrid>
        </MudContainer>
    </MudItem>
</MudGrid>
<FooterComponent/>

@code {

    // parameters passed via URL
    [Parameter] public string? Category { get; set; }
    [Parameter] public string? Sports { get; set; }

    // Breadcrumb items
    private List<BreadcrumbItem> _items = new();
    private int _activeTabIndex = 0;


    // variables to store data from API calls
    private List<SportsDTO.SportSubcategories>? _sportSubcategories;
    private List<EventsDTO.EventDetails.Event>? _eventDetails;
    private List<GeneralScheduleDTO> _generalSchedules = new();

    private int? _currentSportId;

    // Grouped Events by Date
    private IEnumerable<IGrouping<DateTime, EventsDTO.EventDetails.Event>> groupedEventsAscendingDate =>
        _eventDetails?
            .Where(e => e.Date.HasValue)
            .GroupBy(e => e.Date!.Value.Date)
            .OrderBy(g => g.Key)
        ?? Enumerable.Empty<IGrouping<DateTime, EventsDTO.EventDetails.Event>>();

    // Grouped Events by Date Descending
    private IEnumerable<IGrouping<DateTime, EventsDTO.EventDetails.Event>> groupedEventsDescendingDate =>
        _eventDetails?
            .Where(e => e.Date.HasValue)
            .GroupBy(e => e.Date!.Value.Date)
            .OrderByDescending(g => g.Key)
        ?? Enumerable.Empty<IGrouping<DateTime, EventsDTO.EventDetails.Event>>();


    private string? _sportDescription;
    private int? _selectedSportCategoryID;
    private bool _dateOrder = true; // Default to ascending order

    private string GetThumbnailUrl(string? url)
    {
        if (string.IsNullOrWhiteSpace(url)) return string.Empty;

        if (url.Contains("youtube.com/watch?v="))
        {
            var videoId = url.Split("v=")[1].Split('&')[0];
            return $"https://img.youtube.com/vi/{videoId}/hqdefault.jpg";
        }

        return "media/images/no-thumbnail-default.webp";
    }

    private string GetMedalColor(int index)
    {
        return index switch
        {
            0 => Colors.Amber.Accent4, // First place (Gold)
            1 => Colors.BlueGray.Lighten4, // Second place (Silver)
            2 => Colors.DeepOrange.Lighten1, // Third place (Bronze)
            _ => "transparent" // Default color for others
        };
    }

    protected override async Task OnInitializedAsync()
    {
        await GetSportCategoriesAsync();
        await GetSportsAsync();
        await GetEventsAsync();
        await GetGeneralSchedulesAsync();

        _items = new List<BreadcrumbItem>
        {
            new("Home", href: "./"),
            new("Sports", href: "./sports"),
            new($"{Category}", href: $"./sports/{Category}"),
            new($"{Sports}", href: null, disabled: true)
        };
    }

    private async Task GetSportCategoriesAsync()
    {
        string url = $"/Sports/Categories?category={Category}";
        var sportCategories = await apiService.GetAsync<SportsDTO.SportCategories>(url);

        if (sportCategories != null)
        {
            var sportCategory = sportCategories.First();

            _selectedSportCategoryID = sportCategory.ID;
        }
    }

    private async Task GetSportsAsync()
    {
        string url = $"/Sports?sport={Sports}&sportCategoryID={_selectedSportCategoryID}";
        var sports = await apiService.GetAsync<SportsDTO.Sports>(url);

        if (sports != null)
        {
            var sport = sports.First();

            _sportDescription = sport.Description;
            _currentSportId = sport.ID;

            await GetSportSubcategoriesAsync(sport.ID);
            await GetGeneralSchedulesAsync();
        }
    }

    private async Task GetSportSubcategoriesAsync(int sportID)
    {
        string url = $"/Sports/Subcategories?sportID={sportID}";
        _sportSubcategories = await apiService.GetAsync<SportsDTO.SportSubcategories>(url);
    }

    private async Task GetEventsAsync()
    {
        string url = $"/Events/Details?category={Category}&sport={Sports}";
        _eventDetails = await apiService.GetAsync<EventsDTO.EventDetails.Event>(url);
    }

    private async Task GetGeneralSchedulesAsync()
    {
        if (!_currentSportId.HasValue) return;

        string url = $"/GeneralSchedule/sport/{_currentSportId.Value}";
        _generalSchedules = await apiService.GetAsync<GeneralScheduleDTO>(url) ?? new();
    }

    private List<GeneralScheduleDTO> GetFilteredGeneralSchedules()
    {
        if (!_currentSportId.HasValue)
            return new List<GeneralScheduleDTO>();

        return _generalSchedules
            .Where(s => !s.IsEvent && s.SportsID == _currentSportId.Value)
            .OrderBy(s => s.Date)
            .ToList();
    }

    private List<EventsDTO.EventDetails.Event> GetFilteredEventDetails(int? schoolLevelId)
    {
        if (_eventDetails == null || !schoolLevelId.HasValue)
            return new List<EventsDTO.EventDetails.Event>();

        return _eventDetails
            .Where(e => DoesEventMatchSchoolLevel(e, schoolLevelId.Value))
            .ToList();
    }

    private bool DoesEventMatchSchoolLevel(EventsDTO.EventDetails.Event eventItem, int schoolLevelId)
    {
        string levelString = schoolLevelId switch
        {
            1 => "Elementary",
            2 => "Secondary",
            3 => "SPED",
            _ => string.Empty
        };

        return !string.IsNullOrEmpty(eventItem.Level) &&
               eventItem.Level.Contains(levelString, StringComparison.OrdinalIgnoreCase);
    }

    private List<DayScheduleGroup> GetSchedulesGroupedByDay(List<GeneralScheduleDTO> schedules)
    {
        var result = new List<DayScheduleGroup>();
        var groupedByDate = schedules
            .Where(s => s.Date.HasValue)
            .GroupBy(s => s.Date.Value.Date)
            .OrderBy(g => g.Key);

        int dayNumber = 1;
        foreach (var dateGroup in groupedByDate)
        {
            result.Add(new DayScheduleGroup
            {
                Date = dateGroup.Key,
                DayLabel = $"Day {dayNumber}",
                Schedules = dateGroup.OrderBy(s => s.Activities.Min(a => a.Time)).ToList()
            });
            dayNumber++;
        }

        return result;
    }

    private List<GeneralScheduleDTO> GetFilteredEventSchedules()
    {
        if (!_currentSportId.HasValue)
            return new List<GeneralScheduleDTO>();

        return _generalSchedules
            .Where(s => s.IsEvent && s.SportsID == _currentSportId.Value)
            .OrderBy(s => s.Date)
            .ToList();
    }


    public class DayScheduleGroup
    {
        public DateTime Date { get; set; }
        public string DayLabel { get; set; } = string.Empty;
        public List<GeneralScheduleDTO> Schedules { get; set; } = new List<GeneralScheduleDTO>();
    }

    // General Schedule DTO
    public class GeneralScheduleDTO
    {
        public int ID { get; set; }
        public int? SportsID { get; set; }
        public DateTime? Date { get; set; }
        public string? Description { get; set; }
        public List<ActivityDTO> Activities { get; set; } = new List<ActivityDTO>();
        public bool IsEvent { get; set; } // Add this property to distinguish event schedules
    }

    public class ActivityDTO
    {
        public int ID { get; set; }
        public int ScheduleID { get; set; }
        public TimeSpan? Time { get; set; }
        public string ActivityName { get; set; } = string.Empty;
    }

    // Events DTO
    public class EventsDTO
    {
        public class EventDetails
        {
            public class Event
            {
                public string ID { get; set; } = null!;
                public string? EventStage { get; set; }
                public List<EventVersusTeams>? EventVersusList { get; set; }
                public string? SportMainCat { get; set; }
                public string? Category { get; set; }
                public string? Sport { get; set; }
                public int? SubCategoryID { get; set; }
                public string? Subcategory { get; set; }
                public string? Gender { get; set; }
                public string? Level { get; set; }
                public string? Venue { get; set; }
                public decimal? Latitude { get; set; }
                public decimal? Longitude { get; set; }
                public DateTime? Date { get; set; }
                public TimeSpan? Time { get; set; }
                public bool? OnStream { get; set; }
                public string? StreamService { get; set; }
                public string? StreamURL { get; set; }
                public bool? IsFinished { get; set; }
                public bool? Archived { get; set; }
                public bool? Deleted { get; set; }
                public string? FirstName { get; set; }
                public string? LastName { get; set; }
            }

            public class EventVersusTeams
            {
                public int ID { get; set; }
                public string? Score { get; set; }
                public string? Region { get; set; }
                public string? Abbreviation { get; set; }

                public List<EventVersusTeamPlayers>? EventVersusTeamPlayersList { get; set; }
                public DateTime? RecentUpdateAt { get; set; }
            }

            public class EventVersusTeamPlayers
            {
                public int ID { get; set; }
                public int? EventVersusID { get; set; }
                public string? FirstName { get; set; }
                public string? LastName { get; set; }
                public string? School { get; set; }
            }
        }
    }

    // Sports DTO
    public class SportsDTO
    {
        public class SportCategories
        {
            public int ID { get; set; }
            public string? Category { get; set; }
        }

        public class Sports
        {
            public int ID { get; set; }
            public string? Sport { get; set; }
            public string? Description { get; set; }
            public int? SportCategoryID { get; set; }
        }

        public class SportSubcategories
        {
            public int ID { get; set; }
            public string? Subcategory { get; set; }
            public int? SportID { get; set; }
            public int? SportGenderCategoryID { get; set; }
            public int? SchoolLevelID { get; set; }
        }
    }

}

}