@page "/"

@using System.Text.Json
@using System.Threading.Tasks
@inject IJSRuntime JSRuntime
@inject APIService apiService
@inject HttpClient httpClient
@inject ThemeService ThemeService

<MudGrid Spacing="20">
    <!-- Hero Content / Header -->
    <MudItem xs="12">
        <MudContainer MaxWidth="MaxWidth.False" Gutters=false>
            <MudStack Class="pt-20 absolute pa-5 z-10" Style="left: 0; top: 0" Spacing="1">
                <MudHidden Breakpoint="Breakpoint.SmAndDown">
                    <MudStack Row Spacing="0" AlignItems="AlignItems.Center" Class="text-blur-out">
                        <MudImage Src="media/logo/logo with 2026.webp" Height="200" Width="200" />
                        <MudStack Spacing="2" Class="pl-2">
                            <MudText Typo="Typo.h2" HtmlTag="h1" Style="color: white; font-weight: bold">
                                PALARONG PAMBANSA
                            </MudText>
                            <MudText Typo="Typo.h3" Class="mt-n3" Style="color: white; font-weight: 200">Agusan del Sur | 2026</MudText>
                            <MudPaper Style="@($"background-color: {Color.Dark}; width: 200px")" Elevation="0" Class="pa-2 rounded-0">
                                @days d : @hours h : @min m : @sec s
                            </MudPaper>
                            <MudText Typo="Typo.body2" Style="color: white">Ongoing Development</MudText>
                        </MudStack>
                    </MudStack>
                </MudHidden>
                <MudHidden Breakpoint="Breakpoint.SmAndUp">
                    <MudStack Spacing="1" AlignItems="AlignItems.Start" Class="text-blur-out pl-2">
                        <MudImage Src="media/logo/Logo with 2026.webp" Height="200" Width="200" />
                        <MudText HtmlTag="h1" Style="color: white; font-weight: bold; font-size: 25px">
                            PALARONG PAMBANSA
                            <MudElement>
                                <MudText Class="mt-n2" Style="color: white; font-weight: 200; font-size: 20px">Agusan del Sur | 2026</MudText>
                            </MudElement>
                        </MudText>
                        <MudPaper Style="@($"background-color: {Color.Dark}")" Elevation="0" Class="pa-2 rounded-0">
                            @days d : @hours h : @min m : @sec s
                        </MudPaper>
                        <MudText Typo="Typo.body2" Style="color: white">Ongoing Development</MudText>
                    </MudStack>
                </MudHidden>
            </MudStack>
            <MudStack Style="position: absolute; width: 100%; height:  calc(100vh - 64px); background: rgba(0,0,0,0.0); z-index: 2;" />
            @if (_sports?.Any() == true)
            {
                <MudCarousel TData="object" Style="height: calc(100vh - 64px); touch-action: none" ShowArrows="false" ShowBullets="false">
                    <MudVirtualize Items="_randomSports" Context="sportData">
                        <MudCarouselItem>
                            <MudStack Style="width: 100%; height: 100%;" Class="relative">

                                <!-- Text Content -->
                                <MudStack Class="absolute pa-5 z-10" Style="left: 0; bottom: 0;" Spacing="0">
                                    <MudText Typo="Typo.h2" Style="color: white; font-weight: bold;">@sportData.Sport</MudText>
                                    <MudText Typo="Typo.body1" Style="color: white;">@sportData.Description</MudText>
                                </MudStack>

                                <!-- Dark Overlay -->
                                <MudStack Style="position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2;">
                                </MudStack>
                                <!-- Background Image -->
                                <MudImage Style="width: 100%; height: 100%;"
                                          Class="absolute z-1 rounded-0 kenburns-top"
                                          Fluid ObjectFit="ObjectFit.Cover"
                                          ObjectPosition="ObjectPosition.Top"
                                          Src="@($"media/sports/images/{sportData.Sport}.webp")" />
                            </MudStack>

                        </MudCarouselItem>
                    </MudVirtualize>
                </MudCarousel>
            }
            else
            {
                <MudPaper Square Elevation="0" Style="height: 100vh; background-color: white" Class="z-1" />
            }
        </MudContainer>
    </MudItem>

    <!-- Home Content -->
    <MudItem xs="12">
        <MudContainer MaxWidth="MaxWidth.Large">
            <MudGrid Spacing="20">

                <MudItem xs="12" md="4">
                    <MudStack>
                        <MudText Typo="Typo.h2">Palarong Pambansa</MudText>
                        <MudText Typo="Typo.caption">Agusan del Sur | 2026</MudText>
                    </MudStack>
                </MudItem>
                <MudItem xs="12" md=8>
                    <MudStack>
                        <MudText>
                            Palarong Pambansa 2026 is set to be a vibrant celebration of athleticism, unity, and Filipino pride. Hosted in the beautiful province of Agusan del Sur, this year’s games promise to be a memorable showcase of youth talent, sportsmanship, and regional camaraderie.
                        </MudText>
                        <MudText>
                            The Palarong Pambansa serves as the premier national sporting event for student-athletes across the Philippines, bringing together the best from public and private schools under the Department of Education. More than just a competition, it’s a platform for nurturing future champions and promoting values such as discipline, teamwork, and resilience.
                        </MudText>
                        <MudText>
                            This year’s Palaro embraces a forward-thinking vision—highlighting innovation in sports management, promoting inclusivity, and celebrating the diverse cultural identity of every Filipino region. Agusan del Sur stands ready to offer not only world-class competition venues, but also an immersive experience that bridges athletic achievement with rich heritage.
                        </MudText>
                        <MudText>
                            As the whole nation gathers in support, Palarong Pambansa 2026 becomes a symbol of hope, strength, and unity—where dreams are built, friendships are formed, and the spirit of the Filipino youth takes center stage.
                        </MudText>
                    </MudStack>
                </MudItem>

                <!-- Featured News Section -->
                <MudItem xs="12">
                    <MudStack>
                        <MudStack>
                            <MudText Typo="Typo.h2">News</MudText>
                            <MudText Typo="Typo.caption">Stay updated with the latest news and developments on Palarong Pambansa 2026, including event preparations, venue updates, and more.</MudText>
                        </MudStack>
                        <MudDivider />
                        <MudStack Class="d-flex flex-nowrap overflow-auto py-3" Row>
                            <MudLink Href="./Agusan del Sur to Host 66th Palarong Pambansa in 2026" Underline="Underline.None">
                                <MudPaper Width="500px" Outlined Class="hover-effect">
                                    <MudStack Spacing="0" AlignItems="AlignItems.Start">
                                        <MudImage ObjectFit="ObjectFit.Contain" Style="height: 100%; width: 100%" Src="media/images/DO-Plaza-Memorial-Sports-Complex.jpg" />
                                        <MudStack Class="pa-3">
                                            <MudText Typo="Typo.body1">
                                                <b>
                                                    Agusan del Sur to Host 66th Palarong Pambansa in 2026
                                                </b>
                                            </MudText>
                                            <MudText Typo="Typo.body2">
                                                The 66th Palarong Pambansa is scheduled to be held in 2026 in Prosperidad, Agusan del Sur, marking the first time the province will host this national sporting event. This opportunity is considered a <i>"dream come true"</i> for the province, which has been aspiring to host the Palaro for about three decades.
                                            </MudText>
                                        </MudStack>
                                    </MudStack>
                                </MudPaper>
                            </MudLink>
                            <MudLink Href="./CRAG 2024 Unveils Upgraded Facilities, Setting the Stage for Palaro 2026" Underline="Underline.None">
                                <MudPaper Width="500px" Outlined Class="hover-effect">
                                    <MudStack Spacing="0" AlignItems="AlignItems.Start">
                                        <MudImage ObjectFit="ObjectFit.Contain" Style="height: 100%; width: 100%" Src="media/images/CRAG 2024.jpg" />
                                        <MudStack Class="pa-3">
                                            <MudText Typo="Typo.body1">
                                                <b>
                                                    CRAG 2024 Unveils Upgraded Facilities, Setting the Stage for Palaro 2026
                                                </b>
                                            </MudText>
                                            <MudText Typo="Typo.body2">
                                                The Agusan del Sur Sports Complex, with its newly upgraded facilities, hosted the Caraga Regional Athletic Games (CRAG) 2024 in Prosperidad, providing a top-tier venue for athletes across the region. Featuring modern sports amenities, the complex demonstrated the province’s commitment to sports development and its capability to host major competitions.
                                            </MudText>
                                        </MudStack>
                                    </MudStack>
                                </MudPaper>
                            </MudLink>
                        </MudStack>
                    </MudStack>
                </MudItem>

                <!-- Tourism Section -->
                <MudItem xs="12">
                    <MudStack>
                        <MudStack>
                            <MudText Typo="Typo.h2">Tourism</MudText>
                            <MudText Typo="Typo.caption">Explore the rich culture, scenic landscapes, and must-visit destinations of Agusan del Sur as it prepares to host Palarong Pambansa 2026.</MudText>
                            <MudDivider />
                        </MudStack>
                        <MudStack Class="flex-md-row">
                            <MudStack Spacing="0">
                                <MudImage ObjectFit="ObjectFit.Contain" Style="height: 100%; width: 100%" Src="media/images/unlock-the-landlocked.png" />
                            </MudStack>
                            <MudStack>
                                <MudText Typo="Typo.body1">
                                    <b>
                                        Discover Agusan del Sur: Beyond the Games
                                    </b>
                                </MudText>
                                <MudText Typo="Typo.body2">
                                    Agusan del Sur—where the excitement goes beyond the games! Discover the natural beauty, rich traditions, and warm hospitality that make this province a one-of-a-kind destination. Whether you’re here to cheer, compete, or explore, Agusan del Sur offers a perfect mix of adventure and relaxation. Come for the competition, stay for the unforgettable experience!
                                </MudText>
                            </MudStack>
                        </MudStack>
                        <MudStack>
                            <MudButton EndIcon="@Icons.Material.Filled.ArrowForward" Variant="Variant.Text" Size="Size.Large" Href="https://tourism.agusandelsur.gov.ph/" Target="_blank">Visit the Official Site</MudButton>
                        </MudStack>
                    </MudStack>
                </MudItem>

                <!-- SPORTS -->
                <MudItem xs="12">
                    <MudStack>
                        <MudStack>
                            <MudText Typo="Typo.h2">Sports</MudText>
                            <MudText Typo="Typo.caption">Palaro Sports features diverse athletic events, promoting competition, teamwork, and inclusivity across various disciplines.</MudText>
                            <MudDivider />
                        </MudStack>
                        <MudTabs KeepPanelsAlive Elevation="0" ApplyEffectsToContainer="true" PanelClass="pa-6">
                            <MudVirtualize Items="_sportCategories" Context="categoryData">
                                <MudTabPanel Style="text-transform: none" Text="@categoryData.Category">
                                    <MudGrid>
                                        <MudVirtualize Items="_sports?.Where(s => s.SportCategoryID == categoryData.ID).ToList()" Context="sport">
                                            <MudItem xs="6" sm="4" md="6" lg="4" xl="3">
                                                <MudLink Href="@($"sports/{categoryData.Category}/{sport.Sport}")" Underline="Underline.None">
                                                    <MudPaper Class="pa-3" Outlined>
                                                        <MudStack AlignItems="AlignItems.Center">
                                                            <MudImage ObjectFit="ObjectFit.Contain" Height="70" Src="@($"media/sports/icons/{(ThemeService.IsDarkMode == true ? "white" : "black")}/{sport.Sport}.webp")" />
                                                            <MudText>@sport.Sport</MudText>
                                                        </MudStack>
                                                    </MudPaper>
                                                </MudLink>
                                            </MudItem>
                                        </MudVirtualize>
                                    </MudGrid>
                                </MudTabPanel>
                            </MudVirtualize>
                        </MudTabs>
                        <MudButton EndIcon="@Icons.Material.Filled.ArrowForward" Variant="Variant.Text" Size="Size.Large" Href="./venues">Sporting Event Venues</MudButton>
                    </MudStack>
                </MudItem>
            </MudGrid>
        </MudContainer>
    </MudItem>
</MudGrid>
<FooterComponent />

@code
{
    private string eventStarted = string.Empty;
    private string days = string.Empty;
    private string hours = string.Empty;
    private string min = string.Empty;
    private string sec = string.Empty;
    private DateTime targetDate = new DateTime(2026, 7, 10, 0, 0, 0);
    private Timer? timer;
    private List<SportsDTO.Sports>? _sports;
    private List<SportsDTO.Sports>? _randomSports;
    private List<SportsDTO.SportCategories>? _sportCategories;


    public class SportsDTO
    {
        public class SportCategories
        {
            public int ID { get; set; }
            public string? Category { get; set; }
        }

        public class Sports
        {
            public int ID { get; set; }
            public string? Sport { get; set; }
            public string? Description { get; set; }
            public int? SportCategoryID { get; set; }
        }
    }

    // Initialization method to fetch data and update UI elements
    protected override async Task OnInitializedAsync()
    {
        ThemeService.OnThemeChanged += StateHasChanged;
        await ThemeService.LoadThemePreference();
        await StartCountdown();
        await GetSportsAsync();
        await GetSportCategoriesAsync();
    }


    private Task StartCountdown()
    {
        // Set up a timer to trigger every second
        timer = new Timer(UpdateCountdown, null, 0, 1000);
        return Task.CompletedTask;
    }

    private void UpdateCountdown(object? state)
    {
        var timeLeft = targetDate - DateTime.Now;

        if (timeLeft.TotalSeconds > 0)
        {
            days = timeLeft.Days.ToString("D2");
            hours = timeLeft.Hours.ToString("D2");
            min = timeLeft.Minutes.ToString("D2");
            sec = timeLeft.Seconds.ToString("D2");
        }
        else
        {
            // Event has started
            eventStarted = "The event has started!";
            timer?.Dispose(); // Stop the timer when the countdown is over
            timer = null; // Clear the reference to the disposed timer
        }

        InvokeAsync(StateHasChanged); // Update UI
    }

    private async Task GetSportsAsync()
    {
        string url = "/Sports";
        _sports = await apiService.GetAsync<SportsDTO.Sports>(url);

        var random = new Random();
        _randomSports = _sports?.OrderBy(_ => random.Next()).ToList();
    }

    private async Task GetSportCategoriesAsync()
    {
        string url = "/Sports/Categories";
        _sportCategories = await apiService.GetAsync<SportsDTO.SportCategories>(url);
    }
}