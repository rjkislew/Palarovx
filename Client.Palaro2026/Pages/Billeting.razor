@page "/billeting"
@inject IJSRuntime JSRuntime

<MudGrid Spacing="0">
    <MudItem xs="12" md="4" Style="z-index: 1; position: absolute">
        <MudPaper Class="ma-3" Elevation="0">
            <MudTabs Elevation="0" MinimumTabWidth="340px" Rounded>
                <MudTabPanel Style="text-transform:none" Icon="@Icons.Material.Filled.LocationOn" Text="Billeting Quarters">
                    <MudSelect Margin="Margin.Dense" Clearable T="string" Variant="Variant.Outlined" AdornmentIcon="@Icons.Material.Filled.LocationOn" AdornmentColor="Color.Primary" FullWidth Label="Region" AnchorOrigin="Origin.BottomCenter">
                        <MudVirtualize Items="regions" Context="region">
                            <MudSelectItem T="string" Value="@region.Name">@region.Name</MudSelectItem>
                        </MudVirtualize>
                    </MudSelect>
                </MudTabPanel>
            </MudTabs>
        </MudPaper>
    </MudItem>
    <MudItem xs="12">
        <MudStack id="map"
                  Style="width: 100%;
                 height: calc(100vh - 64px);
                 overflow: hidden ">
        </MudStack>
    </MudItem>
</MudGrid>

@code {
    private string mapboxToken = MapBoxService.mapboxToken;

    private List<Region> regions = new List<Region>
    {
        new Region { Name = "Caraga (Region XIII)", Latitude = 8.504487460001194, Longitude = 125.982138223011 },
        new Region { Name = "National Capital Region (NCR)", Latitude = 14.599512, Longitude = 120.984222 },
        new Region { Name = "Cordillera (CAR)", Latitude = 16.418908, Longitude = 120.597235 },
        new Region { Name = "Ilocos (Region I)", Latitude = 16.640247, Longitude = 120.489005 },
        new Region { Name = "Cagayan Valley (Region II)", Latitude = 17.575134, Longitude = 121.702004 },
        new Region { Name = "Central Luzon (Region III)", Latitude = 15.287208, Longitude = 120.589570 },
        new Region { Name = "CALABARZON (Region IV-A)", Latitude = 14.251352, Longitude = 121.042312 },
        new Region { Name = "MIMAROPA (Region IV-B)", Latitude = 13.559868, Longitude = 121.018567 },
        new Region { Name = "Bicol (Region V)", Latitude = 13.736013, Longitude = 123.095373 },
        new Region { Name = "Western Visayas (Region VI)", Latitude = 10.696407, Longitude = 122.559487 },
        new Region { Name = "Central Visayas (Region VII)", Latitude = 9.928951, Longitude = 123.395608 },
        new Region { Name = "Eastern Visayas (Region VIII)", Latitude = 11.218571, Longitude = 124.675210 },
        new Region { Name = "Zamboanga (Region IX)", Latitude = 8.006165, Longitude = 122.085390 },
        new Region { Name = "Northern Mindanao (Region X)", Latitude = 8.482831, Longitude = 124.646281 },
        new Region { Name = "Davao (Region XI)", Latitude = 7.190712, Longitude = 125.455337 },
        new Region { Name = "Cotabato (Region XII)", Latitude = 7.214238, Longitude = 124.711128 },
        new Region { Name = "Bangsamoro (BARMM)", Latitude = 7.716539, Longitude = 124.256348 }
    };

    public class Region
    {
        public string? Name { get; set; }
        public double Latitude { get; set; }
        public double Longitude { get; set; }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initializeMap", "map", mapboxToken);
        }
    }
}
